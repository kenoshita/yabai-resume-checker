<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ã‚„ã°ã„è·å‹™çµŒæ­´æ›¸ãƒã‚§ãƒƒã‚«ãƒ¼ï¼ˆå®‰å®šç‰ˆï¼‰</title>
<style>
  body{font-family:system-ui,-apple-system,"Segoe UI",Arial; margin:0; padding:24px; background:#0f1115; color:#e9eef5}
  .card{max-width:900px; margin:0 auto; background:#171a21; border:1px solid #2a3240; border-radius:12px; padding:20px}
  h1{margin:0 0 8px} .muted{color:#aab4c3}
  .btn{padding:10px 14px; border-radius:8px; border:1px solid #2a3240; background:#232934; color:#e9eef5; cursor:pointer}
  .hidden{display:none}
  #drop{margin:12px 0; padding:24px; text-align:center; border:2px dashed #2e3747; border-radius:12px; background:#1e232c}
  #drop.drag{border-color:#7ab7ff; box-shadow:0 0 0 4px rgba(122,183,255,.15) inset}
  .issue{padding:10px; margin:10px 0; border:1px solid #2a3240; border-radius:8px; background:#1e232c}
  .sev{font-size:12px; padding:2px 8px; border-radius:999px; margin-left:8px; border:1px solid #2a3240}
  .sev.high{background:rgba(255,90,95,.12)}
  .sev.med{background:rgba(248,192,44,.12)}
  .sev.low{background:rgba(88,192,164,.12)}
  #loading{margin:16px 0}
  #toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);background:#10151E;border:1px solid #2A3240;color:#E9EEF5;padding:10px 14px;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.35)}
</style>
</head>
<body>
<div class="card">
  <h1>ã‚„ã°ã„è·å‹™çµŒæ­´æ›¸ãƒã‚§ãƒƒã‚«ãƒ¼ï¼ˆãƒ¢ãƒƒã‚¯ãƒ»å®‰å®šç‰ˆï¼‰</h1>
  <p class="muted">PDF / DOC / DOCX / TXT / RTF ã«å¯¾å¿œï¼ˆãƒ¢ãƒƒã‚¯è§£æï¼‰ã€‚</p>

  <div id="drop" tabindex="0" aria-label="ã“ã“ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã‹ã€ä¸‹ã®ãƒœã‚¿ãƒ³ã§é¸æŠ">
    ã“ã“ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—
  </div>
  <input id="file" type="file" accept=".pdf,.doc,.docx,.txt,.rtf">
  <button id="reupload" class="btn hidden">åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§è©¦ã™</button>

  <div id="loading" class="hidden" aria-live="polite">è§£æä¸­â€¦</div>

  <div id="result" class="hidden">
    <h3 style="margin:16px 0 8px">ğŸ” ã‚„ã°ãƒã‚¤ãƒ³ãƒˆ <span id="count">0</span>ä»¶</h3>
    <div id="list"></div>
    <button id="showGuide" class="btn">æ”¹å–„ã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤º</button>
    <div id="guides" class="hidden" style="margin-top:12px">
      <div class="issue">
        <strong>æˆæœãŒæ•°å€¤ã§ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“</strong> <span class="sev high">HIGH</span>
        <div class="muted">ä¾‹ï¼‰æ–°è¦æ¡ˆä»¶ å¹´é–“â—¯â—¯ä»¶ / å‰å¹´æ¯”â—¯â—¯% / ãƒªãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ â—¯â—¯æ—¥çŸ­ç¸®ï¼ˆæ•°å€¤ã¯ã”è‡ªèº«ã§ï¼‰</div>
      </div>
      <div class="issue">
        <strong>è·å‹™å†…å®¹ãŒæŠ½è±¡çš„ã§ã™</strong> <span class="sev med">MED</span>
        <div class="muted">ã‚¿ã‚¹ã‚¯ã‚’åˆ—æŒ™ï¼ˆé »åº¦ãƒ»è¦æ¨¡ãƒ»ãƒ„ãƒ¼ãƒ«ã‚‚ï¼‰</div>
      </div>
      <div class="issue">
        <strong>é€€è·ç†ç”±ãŒãƒã‚¬ãƒ†ã‚£ãƒ–ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™</strong> <span class="sev med">MED</span>
        <div class="muted">å‰å‘ããªå‹•æ©Ÿã«è¨€ã„æ›ãˆï¼ˆã‚¹ã‚­ãƒ«å‘ä¸Š/æ–°é ˜åŸŸæŒ‘æˆ¦ ç­‰ï¼‰</div>
      </div>
      <div class="issue">
        <strong>æ—¥ä»˜å½¢å¼ãŒä¸çµ±ä¸€ã§ã™</strong> <span class="sev low">LOW</span>
        <div class="muted">YYYYå¹´MMæœˆã§çµ±ä¸€ã€åŠè§’/å…¨è§’æ··åœ¨ã«æ³¨æ„</div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // --- äºˆé˜²ï¼šã©ã“ã‹ã§JSã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸã‚‰é€šçŸ¥ã—ã¦æ­¢ã¾ã‚‰ãªã„ã‚ˆã†ã« ---
  window.addEventListener('error', e=>{
    showToast('ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¨ãƒ©ãƒ¼: ' + (e.message || 'unknown'));
  });

  const $id = (x)=>document.getElementById(x);
  const file  = $id('file');
  const drop  = $id('drop');
  const load  = $id('loading');
  const res   = $id('result');
  const list  = $id('list');
  const count = $id('count');
  const showGuide = $id('showGuide');
  const guides = $id('guides');
  const reupload = $id('reupload');

  const MOCK_ISSUES = [
    {title:"æˆæœãŒæ•°å€¤ã§ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“", sev:"high", evidence:["ãƒ»å£²ä¸Šæ‹¡å¤§ã«è²¢çŒ®ã—ã¾ã—ãŸ"]},
    {title:"è·å‹™å†…å®¹ãŒæŠ½è±¡çš„ã§ã™", sev:"med", evidence:["ãƒ»è‰²ã€…ãªæ¥­å‹™ã‚’æ‹…å½“ã—ã¾ã—ãŸ"]},
    {title:"é€€è·ç†ç”±ãŒãƒã‚¬ãƒ†ã‚£ãƒ–ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™", sev:"med", evidence:["ãƒ»äººé–“é–¢ä¿‚ã®æ‚ªåŒ–ã«ã‚ˆã‚Šé€€è·"]},
    {title:"æ—¥ä»˜å½¢å¼ãŒä¸çµ±ä¸€ã§ã™", sev:"low",  evidence:["ãƒ»2021/4 ã¨ 2021å¹´04æœˆ ãŒæ··åœ¨"]}
  ];
  const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));

  // ã‚¯ãƒªãƒƒã‚¯é¸æŠ
  file.addEventListener('change', (e)=>{
    const f = e.target.files && e.target.files[0];
    runAnalysis(f);
  });

  // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
  ;['dragenter','dragover'].forEach(type=>{
    drop.addEventListener(type, e=>{ e.preventDefault(); drop.classList.add('drag'); });
  });
  ;['dragleave','drop'].forEach(type=>{
    drop.addEventListener(type, e=>{ e.preventDefault(); drop.classList.remove('drag'); });
  });
  drop.addEventListener('drop', (e)=>{
    const f = e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0];
    runAnalysis(f);
  });

  // ã‚¬ã‚¤ãƒ‰ã®é–‹é–‰
  showGuide.addEventListener('click', ()=>{
    guides.classList.toggle('hidden');
    showGuide.textContent = guides.classList.contains('hidden') ? 'æ”¹å–„ã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤º' : 'æ”¹å–„ã‚¬ã‚¤ãƒ‰ã‚’é–‰ã˜ã‚‹';
  });

  // ã‚„ã‚Šç›´ã—
  reupload.addEventListener('click', ()=>{
    res.classList.add('hidden');
    guides.classList.add('hidden');
    showGuide.textContent = 'æ”¹å–„ã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤º';
    file.value = "";
    file.disabled = false;
    showToast('åˆæœŸåŒ–ã—ã¾ã—ãŸ');
  });

  // å…±é€šè§£æï¼ˆã‚¯ãƒªãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—ä¸¡æ–¹ã‹ã‚‰ä½¿ç”¨ï¼‰
  async function runAnalysis(f){
    if(!f){ showToast('ãƒ•ã‚¡ã‚¤ãƒ«ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ'); return; }
    if(!/\.(pdf|docx?|txt|rtf)$/i.test(f.name)){
      alert('å¯¾å¿œå½¢å¼: PDF / DOC / DOCX / TXT / RTF');
      return;
    }

    try{
      file.disabled = true;
      res.classList.add('hidden');
      guides.classList.add('hidden');
      showGuide.textContent = 'æ”¹å–„ã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤º';
      load.classList.remove('hidden');

      // ç›£è¦–ï¼ˆæœ€å¤§5ç§’ã§å¿…ãšè§£é™¤ï¼‰
      let timedOut = false;
      const watchdog = setTimeout(()=>{
        timedOut = true;
        load.classList.add('hidden');
        file.disabled = false;
        showToast('è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†è©¦è¡Œã—ã¦ãã ã•ã„');
      }, 5000);

      // ãƒ¢ãƒƒã‚¯è§£æ
      await sleep(900);

      if (timedOut) return; // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ¸ˆãªã‚‰ä½•ã‚‚ã—ãªã„
      clearTimeout(watchdog);

      // çµæœæç”»
      list.innerHTML = "";
      MOCK_ISSUES.forEach(i=>{
        const div = document.createElement('div');
        div.className = 'issue';
        const sevClass = i.sev === 'high' ? 'high' : i.sev === 'med' ? 'med' : 'low';
        div.innerHTML = `<strong>${i.title}</strong> <span class="sev ${sevClass}">${i.sev.toUpperCase()}</span><div class="muted">${(i.evidence||[]).join(' / ')}</div>`;
        list.appendChild(div);
      });
      count.textContent = String(MOCK_ISSUES.length);

      load.classList.add('hidden');
      res.classList.remove('hidden');
      reupload.classList.remove('hidden');
    } catch(err){
      console.error(err);
      load.classList.add('hidden');
      file.disabled = false;
      alert('æƒ³å®šå¤–ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    } finally {
      // æ¬¡å›ã®ãŸã‚ã«ç©ºã«ã—ã¦ãŠãï¼ˆåŒã˜ãƒ•ã‚¡ã‚¤ãƒ«å†é¸æŠã§changeãŒç™ºç«ã—ãªã„å•é¡Œã®å›é¿ï¼‰
      file.value = "";
    }
  }

  function showToast(msg){
    let t = document.getElementById('toast');
    if(!t){
      t = document.createElement('div'); t.id='toast'; document.body.appendChild(t);
      setTimeout(()=>{ if(t) t.remove(); }, 2000);
    }
    t.textContent = msg;
  }

  console.log('[ready] minimal stable build loaded');
})();
</script>
</body>
</html>
