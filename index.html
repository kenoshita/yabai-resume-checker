<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ã‚„ã°ã„è·å‹™çµŒæ­´æ›¸ãƒã‚§ãƒƒã‚«ãƒ¼</title>
<meta name="description" content="è·å‹™çµŒæ­´æ›¸ã®â€œã‚„ã°ãƒã‚¤ãƒ³ãƒˆâ€ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦æ”¹å–„ã‚¬ã‚¤ãƒ‰ã‚’æç¤ºã™ã‚‹ç„¡æ–™ãƒ„ãƒ¼ãƒ«ï¼ˆãƒ¢ãƒƒã‚¯ç‰ˆï¼‰">
<link rel="icon" href="./favicon.svg">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--bg:#0f1115;--panel:#171A21;--panel-2:#1E232C;--text:#E9EEF5;--muted:#AAB4C3;--accent:#F8C02C;--danger:#FF5A5F;--link:#7AB7FF;--border:#2A3240;--shadow:0 8px 24px rgba(0,0,0,.35);--radius:12px;--maxw:1040px;--font:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Arial,sans-serif}
  *{box-sizing:border-box}html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font-family:var(--font);-webkit-font-smoothing:antialiased;line-height:1.65;letter-spacing:.2px}
  a{color:var(--link)}
  header{position:sticky;top:0;z-index:10;background:rgba(15,17,21,.7);backdrop-filter:saturate(140%) blur(8px);border-bottom:1px solid var(--border)}
  .container{max-width:var(--maxw);margin:0 auto;padding:0 16px}
  .center{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
  .brand{display:flex;align-items:center;gap:10px;font-weight:700}
  .logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--danger),var(--accent));box-shadow:0 4px 18px rgba(255,90,95,.35)}
  .hero{padding:32px 0 8px}
  .hero h1{margin:.2em 0 .1em;font-size:clamp(22px,3.2vw,32px)}
  .muted{color:var(--muted)}
  .grid{display:grid;gap:24px}
  .panel{background:var(--panel);border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow)}
  .card{padding:20px}
  .drop{display:flex;align-items:center;justify-content:center;text-align:center;min-height:180px;border:2px dashed #2E3747;border-radius:16px;background:var(--panel-2);transition:.2s;outline:none;cursor:pointer}
  .drop:hover,.drop.drag{border-color:#7AB7FF;box-shadow:0 0 0 4px rgba(122,183,255,.15) inset}
  .btn{appearance:none;border:1px solid var(--border);background:#232934;color:#E9EEF5;padding:10px 14px;border-radius:10px;cursor:pointer}
  .btn.primary{background:linear-gradient(135deg,#2C6BFF,#7AB7FF);border-color:transparent;color:#fff;font-weight:600}
  .progress{padding:28px;text-align:center}
  .spinner{width:44px;height:44px;border-radius:50%;border:4px solid #2E3747;border-top-color:var(--accent);margin:12px auto 8px;animation:spin 1s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
  .content{display:grid;grid-template-columns:1fr;gap:24px}
  @media(min-width:1024px){.content{grid-template-columns:minmax(0,1fr) 320px}.aside{position:sticky;top:72px;height:max-content}}
  .summary{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:14px 16px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,rgba(255,90,95,.08),rgba(255,90,95,0));border-top-left-radius:12px;border-top-right-radius:12px}
  .badge{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid var(--border);background:#202632}
  .acc{padding:0}.acc-item{border-top:1px solid var(--border)}
  .acc-btn{width:100%;text-align:left;padding:16px;background:transparent;border:0;color:var(--text);display:flex;align-items:center;gap:10px;cursor:pointer}
  .acc-btn:focus{outline:2px solid #35507A;outline-offset:-2px;border-radius:8px}
  .acc-icon{width:20px;text-align:center}
  .acc-title{flex:1}
  .acc-count{color:var(--muted);font-size:13px}
  .acc-panel{max-height:0;overflow:hidden;transition:max-height .25s ease}
  .acc-panel.open{padding:0 16px 12px}
  .issue{display:grid;grid-template-columns:1fr;gap:10px;padding:12px;margin:10px 0;border:1px solid var(--border);border-radius:10px;background:var(--panel-2)}
  .sev{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid var(--border)}
  .sev.high{background:rgba(255,90,95,.12)}
  .sev.med{background:rgba(248,192,44,.12)}
  .sev.low{background:rgba(88,192,164,.12)}
  .cta-bar{position:sticky;bottom:0;z-index:5;background:rgba(23,26,33,.85);backdrop-filter:blur(6px);border-top:1px solid var(--border);padding:10px 12px;display:flex;gap:10px;justify-content:space-between;align-items:center}
  .ad-slot{background:linear-gradient(90deg,#1B2431,#20293A);border:1px dashed #3A4760;border-radius:12px;padding:16px;text-align:center;color:#AAB4C3}
  .guide{display:grid;gap:12px;padding:16px;border:1px solid var(--border);border-radius:12px;background:var(--panel-2)}
  .notes{width:100%;min-height:90px;border-radius:10px;border:1px solid var(--border);background:#11161F;color:#E9EEF5;padding:10px 12px;resize:vertical}
  #toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);background:#10151E;border:1px solid #2A3240;color:#E9EEF5;padding:10px 14px;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.35);opacity:0;transition:.2s}
</style>
</head>
<body>
<header>
  <div class="container center">
    <div class="brand"><div class="logo" aria-hidden="true"></div><span>ã‚„ã°ã„è·å‹™çµŒæ­´æ›¸ãƒã‚§ãƒƒã‚«ãƒ¼</span></div>
    <nav><a class="btn" href="./privacy.html">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼</a></nav>
  </div>
</header>

<main class="container">
  <section class="hero" aria-labelledby="h-title">
    <h1 id="h-title">3åˆ†ã§â€œã‚„ã°ãƒã‚¤ãƒ³ãƒˆâ€ã‚’å¯è¦–åŒ–</h1>
    <p class="muted">PDF / Word / TXT ã«å¯¾å¿œã€‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦å³ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰ã€‚</p>
  </section>

  <!-- ã‚¹ãƒ†ãƒƒãƒ—0ï¼šã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
  <section id="upload" class="grid">
    <div class="panel card">
      <label id="drop" class="drop" tabindex="0" for="file" aria-label="ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã€ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ">
        <div>
          <div style="font-size:28px;text-align:center">ğŸ“‚</div>
          <div style="text-align:center"><strong>è·å‹™çµŒæ­´æ›¸ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</strong></div>
          <div class="muted" style="text-align:center">å¯¾å¿œå½¢å¼: PDF / DOCX / TXT ãƒ» æœ€å¤§10MB</div>
          <div style="text-align:center;margin-top:8px"><button type="button" class="btn" id="pick">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</button></div>
        </div>
      </label>
      <input id="file" type="file" accept=".pdf,.doc,.docx,.txt,.rtf" hidden>
      <p class="muted" style="margin-top:8px">â€» æœ¬ãƒ¢ãƒƒã‚¯ã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§ãƒ€ãƒŸãƒ¼è§£æã€‚ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãªã—ã€‚</p>
    </div>
  </section>

  <!-- ã‚¹ãƒ†ãƒƒãƒ—0.5ï¼šè§£æä¸­ -->
  <section id="loading" class="panel progress" hidden aria-live="polite">
    <div class="spinner" role="status" aria-label="è§£æä¸­"></div>
    <div>è§£æä¸­â€¦æ•°ç§’ãŠå¾…ã¡ãã ã•ã„</div>
  </section>

  <!-- ã‚¹ãƒ†ãƒƒãƒ—1+2ï¼šçµæœ & ã‚¬ã‚¤ãƒ‰ -->
  <section id="content" class="content" hidden>
    <div>
      <div class="panel">
        <div class="summary">
          <div><strong>ğŸ” ã‚„ã°ãƒã‚¤ãƒ³ãƒˆ <span id="issueCount">0</span>ä»¶</strong> <span class="badge"><span style="width:7px;height:7px;border-radius:50%;background:#FF5A5F;display:inline-block"></span> é‡è¦ã‚ã‚Š</span></div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button id="openGuides" class="btn primary">è©³ç´°ã‚¬ã‚¤ãƒ‰ã‚’è¦‹ã‚‹</button>
            <button id="retry" class="btn">åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§è©¦ã™</button>
          </div>
        </div>
        <div id="accRoot" class="acc" role="region" aria-label="æ¤œå‡ºã‚«ãƒ†ã‚´ãƒª"></div>
        <div class="cta-bar">
          <span class="muted">æ”¹å–„ã®ãƒ’ãƒ³ãƒˆã‚’è¡¨ç¤º</span>
          <button id="openGuidesMobile" class="btn primary">è©³ç´°ã‚¬ã‚¤ãƒ‰ã‚’è¦‹ã‚‹</button>
        </div>
      </div>

      <div id="guidesSection" class="panel card" hidden>
        <div id="adSlot" class="ad-slot">
          <div>ã‚¹ãƒãƒ³ã‚µãƒ¼è¡¨ç¤ºï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰</div>
          <div class="muted">æ•°ç§’å¾Œã«æ”¹å–„ã‚¬ã‚¤ãƒ‰ãŒé–‹ãã¾ã™ï¼ˆéŸ³å£°ãªã—ï¼‰</div>
        </div>
        <div style="height:12px"></div>
        <div id="guidesRoot" class="grid" style="gap:16px" hidden></div>
        <div style="height:12px"></div>
        <div style="display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap">
          <button id="exportTxt" class="btn">ãƒ†ã‚­ã‚¹ãƒˆã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
          <button id="copyAll" class="btn">å…¨ä½“ã‚’ã‚³ãƒ”ãƒ¼</button>
        </div>
      </div>
    </div>

    <aside class="aside">
      <div class="panel card">
        <h3 style="margin:0 0 6px">ãƒã‚§ãƒƒã‚¯æ–¹é‡</h3>
        <ul class="muted" style="margin:0; padding-left:18px">
          <li>å…·ä½“æ•°å€¤ã¯ç”Ÿæˆã—ã¾ã›ã‚“ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ï¼‰</li>
          <li>éåº¦ãªè£…é£¾ã¯ATSã§ä¸åˆ©</li>
          <li>ãƒã‚¬ãƒ†ã‚£ãƒ–è¡¨ç¾ã¯å‰å‘ãã«è¨€ã„æ›ãˆ</li>
        </ul>
      </div>
      <div style="height:12px"></div>
      <div class="panel card">
        <h3 style="margin:0 0 6px">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼</h3>
        <p class="muted" style="margin:0">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã¯ä¿å­˜ã—ã¾ã›ã‚“ã€‚</p>
      </div>
    </aside>
  </section>
</main>

<div id="toast"></div>

<script>
(function(){
  // === ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===
  const $ = (s)=>document.querySelector(s);
  const $$ = (s)=>Array.from(document.querySelectorAll(s));
  const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));
  function toast(msg){
    const t = $('#toast'); t.textContent = msg; t.style.opacity = '1';
    setTimeout(()=>{ t.style.opacity = '0'; }, 1600);
  }
  function el(tag, attrs={}, ...children){
    const n = document.createElement(tag);
    for (const [k,v] of Object.entries(attrs)){
      if (k==='class') n.className = v;
      else if (k.startsWith('on') && typeof v==='function') n.addEventListener(k.slice(2), v);
      else if (v!=null) n.setAttribute(k,v);
    }
    children.forEach(c=> n.appendChild(typeof c==='string'? document.createTextNode(c): c));
    return n;
  }

  // === DOMå‚ç…§ ===
  const drop = $('#drop'), file = $('#file'), pick = $('#pick');
  const secUpload = $('#upload'), secLoading = $('#loading'), secContent = $('#content');
  const accRoot = $('#accRoot'), issueCount = $('#issueCount');
  const btnGuides = $('#openGuides'), btnGuidesM = $('#openGuidesMobile'), btnRetry = $('#retry');
  const guidesSection = $('#guidesSection'), adSlot = $('#adSlot'), guidesRoot = $('#guidesRoot');
  const btnExport = $('#exportTxt'), btnCopy = $('#copyAll');

  // === ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ ===
  const MOCK_ISSUES = [
    {id:"lack-metrics",title:"æˆæœãŒæ•°å€¤ã§ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“",category:"ä¿¡é ¼æ€§ãƒ»å…·ä½“æ€§",severity:"high",evidence:["ãƒ»å£²ä¸Šæ‹¡å¤§ã«è²¢çŒ®ã—ã¾ã—ãŸ","ãƒ»é¡§å®¢æº€è¶³åº¦å‘ä¸Šã«å°½åŠ›ã—ã¾ã—ãŸ"]},
    {id:"vague-role",title:"è·å‹™å†…å®¹ãŒæŠ½è±¡çš„ã§ã™",category:"ä¿¡é ¼æ€§ãƒ»å…·ä½“æ€§",severity:"med",evidence:["ãƒ»è‰²ã€…ãªæ¥­å‹™ã‚’æ‹…å½“ã—ã¾ã—ãŸ"]},
    {id:"neg-leaving",title:"é€€è·ç†ç”±ãŒãƒã‚¬ãƒ†ã‚£ãƒ–ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™",category:"ãƒã‚¬ãƒ†ã‚£ãƒ–å°è±¡ãƒ¯ãƒ¼ãƒ‰",severity:"med",evidence:["ãƒ»äººé–“é–¢ä¿‚ã®æ‚ªåŒ–ã«ã‚ˆã‚Šé€€è·"]},
    {id:"format-dates",title:"æ—¥ä»˜å½¢å¼ãŒä¸çµ±ä¸€ã§ã™",category:"åŸºæœ¬æƒ…å ±ãƒ»ä½“è£",severity:"low",evidence:["ãƒ»2021/4 ã¨ 2021å¹´04æœˆ ãŒæ··åœ¨"]}
  ];
  const CATEGORY_ORDER = ["åŸºæœ¬æƒ…å ±ãƒ»ä½“è£","ä¿¡é ¼æ€§ãƒ»å…·ä½“æ€§","ãƒã‚¬ãƒ†ã‚£ãƒ–å°è±¡ãƒ¯ãƒ¼ãƒ‰","èª¤å­—ãƒ»å½¢å¼çš„ã‚¨ãƒ©ãƒ¼","ATSã«ä¸åˆ©","èª­ã¿æ‰‹å°è±¡ã‚’ä¸‹ã’ã‚‹æ§‹æˆ"];
  const GUIDES = {
    "lack-metrics":{title:"æˆæœãŒæ•°å€¤ã§ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“",tips:["æˆæœã¯æ•°å€¤ãƒ»å‰²åˆãƒ»ä»¶æ•°ãƒ»è¦æ¨¡ãƒ»æœŸé–“ãƒ»æ¯”è¼ƒå¯¾è±¡ã‚’æ·»ãˆã‚‹","å…·ä½“æ•°å€¤ã¯ã‚ãªãŸè‡ªèº«ã§å…¥åŠ›ï¼ˆè™šå½é˜²æ­¢ï¼‰","æ¯”è¼ƒè»¸ï¼ˆå‰å¹´æ¯”/å‰å››åŠæœŸæ¯”/ç›®æ¨™æ¯”ï¼‰ã‚’æ˜ç¢ºã«"],placeholder:"ä¾‹ï¼‰æ–°è¦æ¡ˆä»¶ å¹´é–“â—¯â—¯ä»¶ï¼å‰å¹´æ¯”â—¯â—¯%ï¼ãƒªãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ â—¯â—¯æ—¥çŸ­ç¸®"},
    "vague-role":{title:"è·å‹™å†…å®¹ãŒæŠ½è±¡çš„ã§ã™",tips:["æ‹…å½“ã‚¿ã‚¹ã‚¯ã‚’åˆ—æŒ™ï¼ˆé¡§å®¢æŠ˜è¡/è³‡æ–™ä½œæˆ/åˆ†æ ç­‰ï¼‰","1ã‚¿ã‚¹ã‚¯=1è¡Œï¼‹è¦æ¨¡/é »åº¦ï¼ˆé€±â—¯å›/æœˆâ—¯ä»¶ï¼‰","ä½¿ç”¨ãƒ„ãƒ¼ãƒ«ãƒ»é–¢ä¸ãƒ•ã‚§ãƒ¼ã‚ºãƒ»ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’æ˜è¨˜"],placeholder:"ä¾‹ï¼‰é€±â—¯å›ã®å®šä¾‹ã€â—¯â—¯è³‡æ–™ï¼ˆæœˆâ—¯æœ¬ï¼‰ã€BI:â—¯â—¯ ãªã©"},
    "neg-leaving":{title:"é€€è·ç†ç”±ãŒãƒã‚¬ãƒ†ã‚£ãƒ–",tips:["å‰å‘ããªå‹•æ©Ÿã«è¨€ã„æ›ãˆï¼ˆæ–°é ˜åŸŸ/ã‚¹ã‚­ãƒ«å‘ä¸Šç­‰ï¼‰","äº‹å®Ÿãƒ™ãƒ¼ã‚¹ã§1ã€œ2è¡Œã€æ„Ÿæƒ…è¡¨ç¾ã¯é¿ã‘ã‚‹","å¿œå‹Ÿè·ç¨®ã¨æ¥ç¶šã™ã‚‹åˆç†çš„ãªç†ç”±ã‚’æ·»ãˆã‚‹"],placeholder:"ä¾‹ï¼‰â—¯â—¯é ˜åŸŸã®å°‚é–€æ€§æ·±åŒ–ã®ãŸã‚ã€ã‚ˆã‚Šâ—¯â—¯ã«è¿‘ã„ç’°å¢ƒã¸"},
    "format-dates":{title:"æ—¥ä»˜å½¢å¼ãŒä¸çµ±ä¸€",tips:["å…¨ä½“ã§è¡¨è¨˜çµ±ä¸€ï¼ˆYYYYå¹´MMæœˆï¼‰","åœ¨ç±æœŸé–“ã¯æœˆã¾ã§ã€ç©ºç™½æœŸé–“ã¯ç°¡æ½”ã«è£œè¶³","åŠè§’ãƒ»å…¨è§’ã®æ··åœ¨ã«æ³¨æ„"],placeholder:"ä¾‹ï¼‰2021å¹´04æœˆã€œ2023å¹´09æœˆã€2023å¹´10æœˆã€œç¾åœ¨"}
  };

  // === å®‰å®šã‚¤ãƒ™ãƒ³ãƒˆ ===
  pick.addEventListener('click', ()=> file.click());
  drop.addEventListener('click', ()=> file.click());
  drop.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); file.click(); }});
  ;['dragenter','dragover'].forEach(type=> drop.addEventListener(type, e=>{ e.preventDefault(); drop.classList.add('drag'); }));
  ;['dragleave','drop'].forEach(type=> drop.addEventListener(type, e=>{ e.preventDefault(); drop.classList.remove('drag'); }));
  drop.addEventListener('drop', (e)=>{ const f = e.dataTransfer?.files?.[0]; runAnalysis(f); });
  file.addEventListener('change', (e)=>{ const f = e.target.files?.[0]; runAnalysis(f); });

  btnRetry.addEventListener('click', ()=>{ secContent.hidden=true; guidesSection.hidden=true; secUpload.hidden=false; guidesRoot.innerHTML=''; });
  btnGuides.addEventListener('click', openGuides);
  btnGuidesM.addEventListener('click', openGuides);

  btnExport.addEventListener('click', ()=>{
    const text = Array.from($$('#guidesRoot .guide')).map(card=>{
      const title = card.querySelector('h4')?.innerText ?? '';
      const val = card.querySelector('textarea')?.value ?? '';
      return `ã€${title}ã€‘\n${val || 'ï¼ˆæœªå…¥åŠ›ï¼‰'}`;
    }).join('\n\n');
    const blob = new Blob([text], {type:'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download='resume-fix-notes.txt'; a.click();
    URL.revokeObjectURL(url);
    toast('ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ');
  });
  btnCopy.addEventListener('click', async ()=>{
    const text = Array.from($$('#guidesRoot .guide')).map(card=>{
      const title = card.querySelector('h4')?.innerText ?? '';
      const tips = Array.from(card.querySelectorAll('.tips li')).map(li=>'ãƒ»'+li.innerText).join('\n');
      const val = card.querySelector('textarea')?.value ?? '';
      return `${title}\n${tips}\n\nã‚ãªãŸã®ä¿®æ­£æ¡ˆ:\n${val}\n`;
    }).join('\n----------------------\n\n');
    await navigator.clipboard.writeText(text);
    toast('å…¨ä½“ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
  });

  // === å…±é€šè§£æ ===
  async function runAnalysis(f){
    if(!f){ toast('ãƒ•ã‚¡ã‚¤ãƒ«ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ'); return; }
    if(!/\.(pdf|docx?|txt|rtf)$/i.test(f.name)){ toast('å¯¾å¿œ: PDF / DOC / DOCX / TXT / RTF'); return; }

    // ç”»é¢åˆ‡æ›¿
    secUpload.hidden = true; secLoading.hidden = false; secContent.hidden = true; guidesSection.hidden = true;

    // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆç›£è¦–ï¼ˆæœ€å¤§5ç§’ã§å¾©å¸°ï¼‰
    let timedOut=false;
    const watchdog = setTimeout(()=>{ timedOut=true; secLoading.hidden=true; secUpload.hidden=false; toast('è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„'); }, 5000);

    // æ“¬ä¼¼è§£æ
    await sleep(900);

    if (timedOut) return;
    clearTimeout(watchdog);

    // ã‚¹ãƒ†ãƒƒãƒ—1 æç”»
    renderIssues(MOCK_ISSUES);

    secLoading.hidden = true; secContent.hidden = false;
    file.value = ""; // åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«å†é¸æŠã§ã‚‚ç™ºç«ã™ã‚‹ã‚ˆã†ã«
  }

  function renderIssues(issues){
    issueCount.textContent = String(issues.length);
    const byCat = {};
    CATEGORY_ORDER.forEach(c=> byCat[c]=[]);
    issues.forEach(i=>{ if(!byCat[i.category]) byCat[i.category]=[]; byCat[i.category].push(i); });

    accRoot.innerHTML = '';
    Object.entries(byCat).forEach(([cat,list])=>{
      if(list.length===0) return;
      const id = 'acc-'+btoa(cat).replace(/=/g,'');
      const btn = el('button',{class:'acc-btn','aria-controls':id,'aria-expanded':'false'},
        el('span',{class:'acc-icon','aria-hidden':'true'},'âš ï¸'),
        el('span',{class:'acc-title'},cat),
        el('span',{class:'acc-count'},`${list.length}ä»¶`)
      );
      const panel = el('div',{id,class:'acc-panel',role:'region','aria-label':cat});
      const wrap = el('div',{class:'acc-item'},btn,panel);
      btn.addEventListener('click',()=>{
        const opened = panel.style.maxHeight && panel.style.maxHeight!=='0px';
        if (opened){ panel.style.maxHeight='0px'; panel.classList.remove('open'); btn.setAttribute('aria-expanded','false'); }
        else { panel.style.maxHeight=panel.scrollHeight+'px'; panel.classList.add('open'); btn.setAttribute('aria-expanded','true'); }
      });
      list.forEach(issue=>{
        const sevClass = issue.severity==='high'?'high':issue.severity==='med'?'med':'low';
        panel.appendChild(el('div',{class:'issue'},
          el('div',{}, el('strong',{},issue.title), el('span',{class:`sev ${sevClass}`},issue.severity.toUpperCase())),
          el('div',{class:'muted'}, (issue.evidence||[]).join(' / '))
        ));
      });
      accRoot.appendChild(wrap);
    });
  }

  async function openGuides(){
    guidesSection.hidden=false; guidesRoot.hidden=true; adSlot.hidden=false;
    await sleep(1600); // åºƒå‘Šã‚¹ãƒ­ãƒƒãƒˆã®è¡¨ç¤ºã‚’æ¨¡æ“¬
    adSlot.hidden=true; buildGuides(MOCK_ISSUES); guidesRoot.hidden=false;
    guidesSection.scrollIntoView({behavior:'smooth',block:'start'});
  }

  function buildGuides(issues){
    guidesRoot.innerHTML='';
    issues.forEach(i=>{
      const g = GUIDES[i.id]; if(!g) return;
      const tips = el('ul',{class:'tips'}, ...g.tips.map(t=> el('li',{},t)));
      const notes = el('textarea',{class:'notes',placeholder:g.placeholder});
      const copy = el('button',{class:'btn',onclick:()=>{navigator.clipboard.writeText(notes.value||'');toast('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')}},'ã‚³ãƒ”ãƒ¼');
      const save = el('button',{class:'btn',onclick:()=>{notes.setAttribute('data-saved','1');toast('ä¸€æ™‚ä¿å­˜ã—ã¾ã—ãŸ')}},'ä¸€æ™‚ä¿å­˜');
      const card = el('div',{class:'guide'}, el('h4',{},'ğŸ’¡ ',g.title), tips, el('label',{},'ã‚ãªãŸã®ä¿®æ­£æ¡ˆã‚’å…¥åŠ›'), notes, el('div',{style:'display:flex;gap:8px;flex-wrap:wrap'}, save, copy));
      guidesRoot.appendChild(card);
    });
  }

  // äºˆé˜²ï¼šã‚°ãƒ­ãƒ¼ãƒãƒ«JSã‚¨ãƒ©ãƒ¼ã‚’è¦‹é€ƒã•ãªã„
  window.addEventListener('error', e=>{ toast('ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¨ãƒ©ãƒ¼: '+(e.message||'unknown')); });

  console.log('[ready] stable enhanced build loaded');
})();
</script>
</body>
</html>
