<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ã‚„ã°ã„è·å‹™çµŒæ­´æ›¸ãƒã‚§ãƒƒã‚«ãƒ¼ï¼ˆè¶…ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰</title>
<style>
  body{font-family:system-ui, -apple-system, "Segoe UI", Arial; margin:0; padding:24px; background:#0f1115; color:#e9eef5}
  .card{max-width:800px; margin:0 auto; background:#171a21; border:1px solid #2a3240; border-radius:12px; padding:20px}
  h1{margin:0 0 12px}
  .muted{color:#aab4c3}
  .btn{padding:10px 14px; border-radius:8px; border:1px solid #2a3240; background:#232934; color:#e9eef5; cursor:pointer}
  .hidden{display:none}
  .issue{padding:10px; margin:10px 0; border:1px solid #2a3240; border-radius:8px; background:#1e232c}
  .sev{font-size:12px; padding:2px 8px; border-radius:999px; margin-left:8px; border:1px solid #2a3240}
  .sev.high{background:rgba(255,90,95,.12)}
  .sev.med{background:rgba(248,192,44,.12)}
  .sev.low{background:rgba(88,192,164,.12)}
</style>
</head>
<body>
  <div class="card">
    <h1>ã‚„ã°ã„è·å‹™çµŒæ­´æ›¸ãƒã‚§ãƒƒã‚«ãƒ¼ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰</h1>
    <p class="muted">æœ€å°æ§‹æˆã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã¶ã¨æ“¬ä¼¼è§£æâ†’è­¦å‘Šã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>

    <!-- 1. ã“ã® input ã‚’æŠ¼ã™ã ã‘ã§OKã€‚ä½™è¨ˆãªãƒ©ãƒ™ãƒ«ã‚„JSã¯ä½¿ã„ã¾ã›ã‚“ -->
    <input id="file" type="file" accept=".pdf,.doc,.docx,.txt,.rtf">
    <button id="reupload" class="btn hidden">åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§è©¦ã™</button>

    <!-- 2. è§£æä¸­ -->
    <div id="loading" class="hidden" aria-live="polite" style="margin:16px 0">è§£æä¸­â€¦</div>

    <!-- 3. çµæœ -->
    <div id="result" class="hidden">
      <h3 style="margin:16px 0 8px">ğŸ” ã‚„ã°ãƒã‚¤ãƒ³ãƒˆ <span id="count">0</span>ä»¶</h3>
      <div id="list"></div>
      <button id="showGuide" class="btn">æ”¹å–„ã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤º</button>
      <div id="guides" class="hidden" style="margin-top:12px">
        <div class="issue">
          <strong>æˆæœãŒæ•°å€¤ã§ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“</strong> <span class="sev high">HIGH</span>
          <div class="muted">ä¾‹ï¼‰æ–°è¦æ¡ˆä»¶ å¹´é–“â—¯â—¯ä»¶ / å‰å¹´æ¯”â—¯â—¯% / ãƒªãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ â—¯â—¯æ—¥çŸ­ç¸® ãªã©ï¼ˆæ•°å€¤ã¯ã”è‡ªèº«ã§ï¼‰</div>
        </div>
        <div class="issue">
          <strong>è·å‹™å†…å®¹ãŒæŠ½è±¡çš„ã§ã™</strong> <span class="sev med">MED</span>
          <div class="muted">ã‚¿ã‚¹ã‚¯ã‚’åˆ—æŒ™ï¼ˆé »åº¦ãƒ»è¦æ¨¡ãƒ»ãƒ„ãƒ¼ãƒ«ã‚‚è¨˜è¼‰ï¼‰</div>
        </div>
      </div>
    </div>
  </div>

<script>
  // --- è¶…ã‚·ãƒ³ãƒ—ãƒ«ï¼šå¯å¤‰ã¯æœ€å°é™ ---
  const file  = document.getElementById('file');
  const load  = document.getElementById('loading');
  const res   = document.getElementById('result');
  const list  = document.getElementById('list');
  const count = document.getElementById('count');
  const showGuide = document.getElementById('showGuide');
  const guides = document.getElementById('guides');
  const reupload = document.getElementById('reupload');

  const MOCK_ISSUES = [
    {title:"æˆæœãŒæ•°å€¤ã§ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“", sev:"high", evidence:["ãƒ»å£²ä¸Šæ‹¡å¤§ã«è²¢çŒ®ã—ã¾ã—ãŸ"]},
    {title:"è·å‹™å†…å®¹ãŒæŠ½è±¡çš„ã§ã™", sev:"med", evidence:["ãƒ»è‰²ã€…ãªæ¥­å‹™ã‚’æ‹…å½“ã—ã¾ã—ãŸ"]},
    {title:"é€€è·ç†ç”±ãŒãƒã‚¬ãƒ†ã‚£ãƒ–ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™", sev:"med", evidence:["ãƒ»äººé–“é–¢ä¿‚ã®æ‚ªåŒ–ã«ã‚ˆã‚Šé€€è·"]},
    {title:"æ—¥ä»˜å½¢å¼ãŒä¸çµ±ä¸€ã§ã™", sev:"low", evidence:["ãƒ»2021/4 ã¨ 2021å¹´04æœˆ ãŒæ··åœ¨"]}
  ];

  function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

  file.addEventListener('change', async (e)=>{
    const f = e.target.files && e.target.files[0];
    if(!f){ return; }
    // ç°¡å˜ãªæ‹¡å¼µå­ãƒã‚§ãƒƒã‚¯
    if(!/\.(pdf|docx?|txt|rtf)$/i.test(f.name)){
      alert('å¯¾å¿œå½¢å¼ã¯ PDF / DOC / DOCX / TXT / RTF ã§ã™');
      file.value = "";
      return;
    }
    // ç”»é¢é·ç§»ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
    file.disabled = true;
    reupload.classList.add('hidden');
    res.classList.add('hidden');
    load.classList.remove('hidden');

    await sleep(700); // æ“¬ä¼¼è§£ææ™‚é–“

    // çµæœæç”»
    list.innerHTML = "";
    MOCK_ISSUES.forEach(i=>{
      const div = document.createElement('div');
      div.className = 'issue';
      const sevClass = i.sev === 'high' ? 'high' : i.sev === 'med' ? 'med' : 'low';
      div.innerHTML = `<strong>${i.title}</strong> <span class="sev ${sevClass}">${i.sev.toUpperCase()}</span><div class="muted">${(i.evidence||[]).join(' / ')}</div>`;
      list.appendChild(div);
    });
    count.textContent = String(MOCK_ISSUES.length);
    load.classList.add('hidden');
    res.classList.remove('hidden');
    reupload.classList.remove('hidden');
  });

  showGuide.addEventListener('click', ()=>{
    guides.classList.toggle('hidden');
    showGuide.textContent = guides.classList.contains('hidden') ? 'æ”¹å–„ã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤º' : 'æ”¹å–„ã‚¬ã‚¤ãƒ‰ã‚’é–‰ã˜ã‚‹';
  });

  reupload.addEventListener('click', ()=>{
    // åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
    file.disabled = false;
    file.value = "";
    res.classList.add('hidden');
    guides.classList.add('hidden');
    showGuide.textContent = 'æ”¹å–„ã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤º';
  });
</script>
</body>
</html>
