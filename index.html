<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ã‚„ã°ã„è·å‹™çµŒæ­´æ›¸ãƒã‚§ãƒƒã‚«ãƒ¼</title>
  <meta name="description" content="è·å‹™çµŒæ­´æ›¸ã®â€œã‚„ã°ãƒã‚¤ãƒ³ãƒˆâ€ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦æ”¹å–„ã‚¬ã‚¤ãƒ‰ã‚’æç¤ºã™ã‚‹ç„¡æ–™ãƒ„ãƒ¼ãƒ«ï¼ˆãƒ¢ãƒƒã‚¯ç‰ˆï¼‰" />
  <link rel="icon" href="/favicon.svg">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0f1115;--panel:#171A21;--panel-2:#1E232C;--text:#E9EEF5;--muted:#AAB4C3;--accent:#F8C02C;--danger:#FF5A5F;--link:#7AB7FF;--border:#2A3240;--chip-high:#FF5A5F;--chip-med:#F8C02C;--chip-low:#58C0A4;--shadow:0 8px 24px rgba(0,0,0,.35);--radius:12px;--maxw:1040px;--font:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Arial,sans-serif}
    *{box-sizing:border-box}html,body{height:100%}body{margin:0;background:var(--bg);color:var(--text);font-family:var(--font);-webkit-font-smoothing:antialiased;line-height:1.65;letter-spacing:.2px}
    a{color:var(--link)}header{position:sticky;top:0;z-index:10;background:rgba(15,17,21,.7);backdrop-filter:saturate(140%) blur(8px);border-bottom:1px solid var(--border)}
    .container{max-width:var(--maxw);margin:0 auto;padding:0 16px}.center{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}.brand .logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--danger),var(--accent));box-shadow:0 4px 18px rgba(255,90,95,.35)}
    .hero{padding:32px 0 8px}.hero h1{margin:.2em 0 .1em;font-size:clamp(22px,3.2vw,32px)}.hero p{margin:.2em 0;color:var(--muted)}
    .grid{display:grid;gap:24px}.panel{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}.card{padding:20px}
    .drop{display:flex;align-items:center;justify-content:center;text-align:center;min-height:180px;border:2px dashed #2E3747;border-radius:16px;background:var(--panel-2);transition:.2s;outline:none;cursor:pointer}
    .drop:hover,.drop.drag{border-color:var(--link);box-shadow:0 0 0 4px rgba(122,183,255,.15) inset}.drop .inner{display:flex;flex-direction:column;gap:10px;align-items:center;justify-content:center}
    .btn{appearance:none;border:1px solid var(--border);background:#232934;color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer}
    .btn.primary{background:linear-gradient(135deg,#2C6BFF,#7AB7FF);border-color:transparent;color:#fff;font-weight:600}.btn.ghost{background:transparent}
    .hint{color:var(--muted);font-size:13px}.muted{color:var(--muted)}.flex{display:flex;gap:12px;flex-wrap:wrap;align-items:center}.spacer{height:12px}
    .progress{padding:28px;text-align:center}.spinner{width:44px;height:44px;border-radius:50%;border:4px solid #2E3747;border-top-color:var(--accent);margin:12px auto 8px;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}.summary{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:14px 16px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,rgba(255,90,95,.08),rgba(255,90,95,0));border-top-left-radius:var(--radius);border-top-right-radius:var(--radius)}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid var(--border);background:#202632}.badge .dot{width:7px;height:7px;border-radius:50%}.dot.high{background:var(--chip-high)}
    .acc{padding:0}.acc-item{border-top:1px solid var(--border)}.acc-btn{width:100%;text-align:left;padding:16px;background:transparent;border:0;color:var(--text);display:flex;align-items:center;gap:10px;cursor:pointer}
    .acc-btn:focus{outline:2px solid #35507A;outline-offset:-2px;border-radius:8px}.acc-icon{width:20px;text-align:center}.acc-title{flex:1}.acc-count{color:var(--muted);font-size:13px}
    .acc-panel{max-height:0;overflow:hidden;transition:max-height .25s ease}.acc-panel.open{padding:0 16px 12px}
    .issue{display:grid;grid-template-columns:1fr;gap:10px;padding:12px;margin:10px 0;border:1px solid var(--border);border-radius:10px;background:var(--panel-2)}
    .issue-head{display:flex;align-items:center;gap:10px}.sev{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid var(--border)}
    .sev.high{background:rgba(255,90,95,.12)}.sev.med{background:rgba(248,192,44,.12)}.sev.low{background:rgba(88,192,164,.12)}
    .cta-bar{position:sticky;bottom:0;z-index:5;background:rgba(23,26,33,.85);backdrop-filter:blur(6px);border-top:1px solid var(--border);padding:10px 12px;display:flex;gap:10px;justify-content:space-between;align-items:center}
    .ad-slot{background:linear-gradient(90deg,#1B2431,#20293A);border:1px dashed #3A4760;border-radius:12px;padding:16px;text-align:center;color:var(--muted)}
    .guide{display:grid;gap:12px;padding:16px;border:1px solid var(--border);border-radius:12px;background:var(--panel-2)}.guide h4{margin:0}.tips{margin:0;padding-left:18px}
    .notes{width:100%;min-height:90px;border-radius:10px;border:1px solid var(--border);background:#11161F;color:var(--text);padding:10px 12px;resize:vertical}
    .mini-actions{display:flex;gap:8px;flex-wrap:wrap}.footer-actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}
    .content{display:grid;grid-template-columns:1fr;gap:24px}@media(min-width:1024px){.content{grid-template-columns:minmax(0,1fr) 320px}.aside{position:sticky;top:72px;height:max-content}}
    footer{margin:40px 0 24px;color:var(--muted);font-size:13px}code.kbd{font-family:ui-monospace,Menlo,Consolas,monospace;background:#0D1219;padding:2px 6px;border-radius:6px;border:1px solid var(--border)}
  </style>
</head>
<body>
  <header role="banner" aria-label="ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼">
    <div class="container center">
      <div class="brand" aria-label="ãƒ–ãƒ©ãƒ³ãƒ‰">
        <div class="logo" aria-hidden="true"></div><span>ã‚„ã°ã„è·å‹™çµŒæ­´æ›¸ãƒã‚§ãƒƒã‚«ãƒ¼</span>
      </div>
      <nav aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼"><a class="btn ghost" href="/privacy.html" aria-label="ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼</a></nav>
    </div>
  </header>

  <main class="container" role="main">
    <section class="hero" aria-labelledby="h-title">
      <h1 id="h-title">3åˆ†ã§â€œã‚„ã°ãƒã‚¤ãƒ³ãƒˆâ€ã‚’å¯è¦–åŒ–</h1>
      <p class="muted">PDF / Word / TXT ã«å¯¾å¿œã€‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦å³ãƒã‚§ãƒƒã‚¯ã€‚</p>
    </section>

    <section id="upload-section" class="grid">
      <div class="panel card" aria-label="ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é ˜åŸŸ">
        <label id="dropzone" class="drop" tabindex="0" for="file-input" aria-describedby="drop-hint" aria-label="ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã€ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ">
          <div class="inner">
            <div style="font-size:28px">ğŸ“‚</div>
            <div><strong>è·å‹™çµŒæ­´æ›¸ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</strong></div>
            <div class="hint" id="drop-hint">å¯¾å¿œå½¢å¼: PDF / DOCX / TXT ãƒ» æœ€å¤§ 10MB</div>
            <div><button type="button" class="btn">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</button></div>
          </div>
        </label>
        <input id="file-input" type="file" accept=".pdf,.doc,.docx,.txt,.rtf" hidden />
        <div class="spacer"></div>
        <div class="hint">â€» æœ¬ãƒ¢ãƒƒã‚¯ã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§ãƒ€ãƒŸãƒ¼è§£æã‚’è¡Œã„ã¾ã™ã€‚å®Ÿãƒ‡ãƒ¼ã‚¿ä¿å­˜ã¯ã—ã¾ã›ã‚“ã€‚</div>
      </div>
    </section>

    <section id="loading-section" class="panel progress" hidden aria-live="polite">
      <div class="spinner" role="status" aria-label="è§£æä¸­"></div>
      <div>è§£æä¸­â€¦æ•°ç§’ãŠå¾…ã¡ãã ã•ã„</div>
    </section>

    <section id="result-wrap" class="content" hidden>
      <div>
        <div class="panel">
          <div class="summary">
            <div class="score"><strong>ğŸ” ã‚„ã°ãƒã‚¤ãƒ³ãƒˆ <span id="issue-count">0</span>ä»¶</strong><span class="badge"><span class="dot high"></span> é‡è¦ã‚ã‚Š</span></div>
            <div class="flex">
              <button id="view-guides-btn" class="btn primary">è©³ç´°ã‚¬ã‚¤ãƒ‰ã‚’è¦‹ã‚‹</button>
              <button id="reupload-btn" class="btn">åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§è©¦ã™</button>
            </div>
          </div>
          <div id="acc-root" class="acc" role="region" aria-label="æ¤œå‡ºã‚«ãƒ†ã‚´ãƒª"></div>
          <div class="cta-bar" aria-hidden="true">
            <span class="muted">æ”¹å–„ã®ãƒ’ãƒ³ãƒˆã‚’è¡¨ç¤º</span>
            <button class="btn primary" id="view-guides-btn-mobile">è©³ç´°ã‚¬ã‚¤ãƒ‰ã‚’è¦‹ã‚‹</button>
          </div>
        </div>

        <div id="guides-section" class="panel card" hidden>
          <div id="ad-slot" class="ad-slot" role="complementary" aria-label="åºƒå‘Šã‚¹ãƒ­ãƒƒãƒˆ">
            <div>ã‚¹ãƒãƒ³ã‚µãƒ¼è¡¨ç¤ºï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰</div>
            <div class="hint">æ•°ç§’å¾Œã«æ”¹å–„ã‚¬ã‚¤ãƒ‰ãŒé–‹ãã¾ã™ï¼ˆéŸ³å£°ã‚ªãƒ•ï¼‰</div>
          </div>
          <div class="spacer"></div>
          <div id="guides-root" class="grid" style="gap:16px" hidden></div>
          <div class="spacer"></div>
          <div class="footer-actions">
            <button id="export-txt" class="btn">ãƒ†ã‚­ã‚¹ãƒˆã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            <button id="copy-all" class="btn">å…¨ä½“ã‚’ã‚³ãƒ”ãƒ¼</button>
          </div>
        </div>
      </div>

      <aside class="aside">
        <div class="panel card">
          <h3 style="margin-top:0">ãƒã‚§ãƒƒã‚¯æ–¹é‡</h3>
          <ul class="muted" style="margin:0; padding-left:18px">
            <li>å…·ä½“æ•°å€¤ã¯ç”Ÿæˆã—ã¾ã›ã‚“ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ï¼‰</li>
            <li>éåº¦ãªè£…é£¾ã¯ATSã§ä¸åˆ©</li>
            <li>ãƒã‚¬ãƒ†ã‚£ãƒ–è¡¨ç¾ã¯å‰å‘ãè¨€ã„æ›ãˆã‚’æ¨å¥¨</li>
          </ul>
        </div>
        <div class="spacer"></div>
        <div class="panel card">
          <h3 style="margin-top:0">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼</h3>
          <p class="muted">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯è§£æå¾Œã«ä¿å­˜ã•ã‚Œã¾ã›ã‚“ã€‚</p>
        </div>
      </aside>
    </section>

    <footer><div class="container">
      <div>Â© ã‚„ã°ã„è·å‹™çµŒæ­´æ›¸ãƒã‚§ãƒƒã‚«ãƒ¼</div>
      <div class="muted">ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ: <code class="kbd">/</code> ã§ã€Œè©³ç´°ã‚¬ã‚¤ãƒ‰ã‚’è¦‹ã‚‹ã€</div>
    </div></footer>
  </main>

  <script>
    const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s)), sleep=ms=>new Promise(r=>setTimeout(r,ms));
    const el=(t,a={},...c)=>{const n=document.createElement(t);for(const[k,v]of Object.entries(a)){if(k==='class')n.className=v;else if(k.startsWith('on')&&typeof v==='function')n.addEventListener(k.slice(2),v);else if(v!=null)n.setAttribute(k,v)}c.forEach(x=>n.appendChild(typeof x==='string'?document.createTextNode(x):x));return n}

    const MOCK_ISSUES=[
      {id:"lack-metrics",title:"æˆæœãŒæ•°å€¤ã§ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“",category:"ä¿¡é ¼æ€§ãƒ»å…·ä½“æ€§",severity:"high",evidence:["ãƒ»å£²ä¸Šæ‹¡å¤§ã«è²¢çŒ®ã—ã¾ã—ãŸ","ãƒ»é¡§å®¢æº€è¶³åº¦å‘ä¸Šã«å°½åŠ›ã—ã¾ã—ãŸ"]},
      {id:"vague-role",title:"è·å‹™å†…å®¹ãŒæŠ½è±¡çš„ã§ã™",category:"ä¿¡é ¼æ€§ãƒ»å…·ä½“æ€§",severity:"med",evidence:["ãƒ»è‰²ã€…ãªæ¥­å‹™ã‚’æ‹…å½“ã—ã¾ã—ãŸ"]},
      {id:"neg-leaving",title:"é€€è·ç†ç”±ãŒãƒã‚¬ãƒ†ã‚£ãƒ–ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™",category:"ãƒã‚¬ãƒ†ã‚£ãƒ–å°è±¡ãƒ¯ãƒ¼ãƒ‰",severity:"med",evidence:["ãƒ»äººé–“é–¢ä¿‚ã®æ‚ªåŒ–ã«ã‚ˆã‚Šé€€è·"]},
      {id:"format-dates",title:"æ—¥ä»˜å½¢å¼ãŒä¸çµ±ä¸€ã§ã™",category:"åŸºæœ¬æƒ…å ±ãƒ»ä½“è£",severity:"low",evidence:["ãƒ»2021/4 ã¨ 2021å¹´04æœˆ ãŒæ··åœ¨"]}
    ];
    const CATEGORY_ORDER=["åŸºæœ¬æƒ…å ±ãƒ»ä½“è£","ä¿¡é ¼æ€§ãƒ»å…·ä½“æ€§","ãƒã‚¬ãƒ†ã‚£ãƒ–å°è±¡ãƒ¯ãƒ¼ãƒ‰","èª¤å­—ãƒ»å½¢å¼çš„ã‚¨ãƒ©ãƒ¼","ATSã«ä¸åˆ©","èª­ã¿æ‰‹å°è±¡ã‚’ä¸‹ã’ã‚‹æ§‹æˆ"];
    const GUIDES={
      "lack-metrics":{title:"æˆæœãŒæ•°å€¤ã§ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“",tips:["æˆæœã¯æ•°å€¤ãƒ»å‰²åˆãƒ»ä»¶æ•°ãƒ»è¦æ¨¡ãƒ»æœŸé–“ãƒ»æ¯”è¼ƒå¯¾è±¡ã‚’æ·»ãˆã‚‹ã¨ä¼ã‚ã‚Šã¾ã™ã€‚","ä¾‹ç¤ºã¯â€œå‹â€ã«ç•™ã‚ã€å…·ä½“æ•°å€¤ã¯ã‚ãªãŸè‡ªèº«ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆè™šå½é˜²æ­¢ï¼‰ã€‚","æ¯”è¼ƒã®è»¸ï¼ˆå‰å¹´æ¯”ãƒ»å‰å››åŠæœŸæ¯”ãƒ»ç›®æ¨™æ¯”ï¼‰ã‚’æ˜ç¢ºã«ã—ã¾ã—ã‚‡ã†ã€‚"],placeholder:"ä¾‹ï¼‰æ–°è¦æ¡ˆä»¶ã®å¹´é–“â—¯â—¯ä»¶ã€å‰å¹´æ¯”â—¯â—¯%ã€å¹³å‡ãƒªãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ â—¯â—¯æ—¥çŸ­ç¸® ãªã©"},
      "vague-role":{title:"è·å‹™å†…å®¹ãŒæŠ½è±¡çš„ã§ã™",tips:["ã€Œè‰²ã€…ã€ã§ã¯ãªãã€æ‹…å½“ã‚¿ã‚¹ã‚¯ã‚’åˆ—æŒ™ã—ã¾ã—ã‚‡ã†ï¼ˆé¡§å®¢æŠ˜è¡ï¼è³‡æ–™ä½œæˆï¼ãƒ‡ãƒ¼ã‚¿åˆ†æ ç­‰ï¼‰ã€‚","1ã‚¿ã‚¹ã‚¯=1è¡Œã§ã€è¦æ¨¡ã‚„é »åº¦ï¼ˆé€±â—¯å›ï¼æœˆâ—¯ä»¶ï¼‰ã‚’æ·»ãˆã‚‹ã¨å…·ä½“æ€§UPã€‚","ä½¿ç”¨ãƒ„ãƒ¼ãƒ«ãƒ»é–¢ä¸ãƒ•ã‚§ãƒ¼ã‚ºãƒ»ç¤¾å†…å¤–ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ã‚‚æ›¸ãã¨åŠ¹æœçš„ã€‚"],placeholder:"ä¾‹ï¼‰é€±â—¯å›ã®é¡§å®¢å®šä¾‹ã€â—¯â—¯è³‡æ–™ä½œæˆï¼ˆæœˆâ—¯æœ¬ï¼‰ã€ãƒ‡ãƒ¼ã‚¿åˆ†æï¼ˆBI: â—¯â—¯ï¼‰ ãªã©"},
      "neg-leaving":{title:"é€€è·ç†ç”±ãŒãƒã‚¬ãƒ†ã‚£ãƒ–ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™",tips:["å‰å‘ããªå‹•æ©Ÿï¼ˆæ–°é ˜åŸŸã¸ã®æŒ‘æˆ¦ï¼ã‚¹ã‚­ãƒ«å‘ä¸Šï¼è²¬ä»»ç¯„å›²æ‹¡å¤§ ç­‰ï¼‰ã«è¨€ã„æ›ãˆã¾ã—ã‚‡ã†ã€‚","äº‹å®Ÿã«å¿ å®Ÿã‹ã¤ç°¡æ½”ã«ï¼ˆ1ã€œ2è¡Œï¼‰ã€‚æ„Ÿæƒ…è¡¨ç¾ã¯é¿ã‘ã¾ã™ã€‚","å¿œå‹Ÿè·ç¨®ã¨æ¥ç¶šã™ã‚‹â€œåˆç†çš„ãªç†ç”±â€ã‚’æ·»ãˆã‚‹ã¨ç´å¾—æ„ŸãŒå¢—ã—ã¾ã™ã€‚"],placeholder:"ä¾‹ï¼‰â—¯â—¯é ˜åŸŸã§ã®å°‚é–€æ€§æ·±åŒ–ã‚’ç›®çš„ã«ã€ã‚ˆã‚Šâ—¯â—¯ã«è¿‘ã„ç’°å¢ƒã‚’å¿—å‘ ãªã©"},
      "format-dates":{title:"æ—¥ä»˜å½¢å¼ãŒä¸çµ±ä¸€ã§ã™",tips:["è¡¨è¨˜ã¯å±¥æ­´æ›¸å…¨ä½“ã§çµ±ä¸€ï¼ˆä¾‹ï¼šYYYYå¹´MMæœˆï¼‰ã€‚","åœ¨ç±æœŸé–“ã¯æœˆã¾ã§è¨˜è¼‰ã—ã€ç©ºç™½æœŸé–“ã¯ç°¡æ½”ã«è£œè¶³ã—ã¾ã—ã‚‡ã†ã€‚","åŠè§’ãƒ»å…¨è§’ã®æ··åœ¨ã«ã‚‚æ³¨æ„ã€‚"],placeholder:"ä¾‹ï¼‰2021å¹´04æœˆã€œ2023å¹´09æœˆã€2023å¹´10æœˆã€œç¾åœ¨"}
    };

    const dropzone=$('#dropzone'), fileInput=$('#file-input'), uploadSection=$('#upload-section'), loadingSection=$('#loading-section');
    const resultWrap=$('#result-wrap'), accRoot=$('#acc-root'), issueCountEl=$('#issue-count');
    const viewGuidesBtn=$('#view-guides-btn'), viewGuidesBtnMobile=$('#view-guides-btn-mobile');
    const guidesSection=$('#guides-section'), adSlot=$('#ad-slot'), guidesRoot=$('#guides-root');
    const reuploadBtn=$('#reupload-btn'), exportTxtBtn=$('#export-txt'), copyAllBtn=$('#copy-all');

    const openFilePicker=()=>fileInput.click();
    dropzone.addEventListener('click', openFilePicker);
    dropzone.addEventListener('keydown', e=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();openFilePicker();}});
    ['dragenter','dragover'].forEach(ev=>dropzone.addEventListener(ev, e=>{e.preventDefault();dropzone.classList.add('drag')}));
    ['dragleave','drop'].forEach(ev=>dropzone.addEventListener(ev, e=>{e.preventDefault();dropzone.classList.remove('drag')}));
    dropzone.addEventListener('drop', e=>{const f=e.dataTransfer.files?.[0];if(f)handleUpload(f)});
    fileInput.addEventListener('change', e=>{const f=e.target.files?.[0];if(f)handleUpload(f)});

    async function handleUpload(file){
      if(!/\.(pdf|docx?|txt|rtf)$/i.test(file.name)){ toast('å¯¾å¿œå½¢å¼ã¯ PDF / DOC / DOCX / TXT / RTF ã§ã™'); return; }
      uploadSection.hidden=true; loadingSection.hidden=false;
      await sleep(1000); renderIssues(MOCK_ISSUES);
      loadingSection.hidden=true; resultWrap.hidden=false;
    }

    function renderIssues(issues){
      issueCountEl.textContent=String(issues.length);
      const byCat={}; CATEGORY_ORDER.forEach(c=>byCat[c]=[]);
      issues.forEach(i=>{ if(!byCat[i.category]) byCat[i.category]=[]; byCat[i.category].push(i); });
      accRoot.innerHTML='';
      Object.entries(byCat).forEach(([cat,list])=>{
        if(list.length===0) return;
        const id='acc-'+btoa(cat).replace(/=/g,'');
        const btn=el('button',{class:'acc-btn','aria-controls':id,'aria-expanded':'false'},
          el('span',{class:'acc-icon','aria-hidden':'true'},'âš ï¸'),
          el('span',{class:'acc-title'},cat),
          el('span',{class:'acc-count'},`${list.length}ä»¶`)
        );
        const panel=el('div',{id,class:'acc-panel',role:'region','aria-label':cat});
        const wrap=el('div',{class:'acc-item'},btn,panel);
        btn.addEventListener('click',()=>{
          const opened=panel.style.maxHeight && panel.style.maxHeight!=='0px';
          if(opened){panel.style.maxHeight='0px';panel.classList.remove('open');btn.setAttribute('aria-expanded','false');}
          else{panel.style.maxHeight=panel.scrollHeight+'px';panel.classList.add('open');btn.setAttribute('aria-expanded','true');}
        });
        list.forEach(issue=>{
          const sevClass=issue.severity==='high'?'high':issue.severity==='med'?'med':'low';
          const block=el('div',{class:'issue'},
            el('div',{class:'issue-head'},el('span',{'aria-hidden':'true'},'âš ï¸'),el('strong',{},issue.title),el('span',{class:`sev ${sevClass}`},issue.severity.toUpperCase())),
            issue.evidence?.length?el('div',{class:'evidence'},'ä¾‹ï¼š'+issue.evidence.join(' / ')):el('div')
          );
          panel.appendChild(block);
        });
        accRoot.appendChild(wrap);
      });
    }

    async function openGuides(){
      guidesSection.hidden=false; guidesRoot.hidden=true; adSlot.hidden=false;
      await sleep(2000); adSlot.hidden=true; buildGuides(MOCK_ISSUES); guidesRoot.hidden=false;
      guidesSection.scrollIntoView({behavior:'smooth',block:'start'});
    }
    function buildGuides(issues){
      guidesRoot.innerHTML='';
      issues.forEach(i=>{
        const g=GUIDES[i.id]; if(!g) return;
        const tipsList=el('ul',{class:'tips'},...g.tips.map(t=>el('li',{},t)));
        const notes=el('textarea',{class:'notes',placeholder:g.placeholder,'data-issue-id':i.id});
        const copyBtn=el('button',{class:'btn',onclick:()=>{navigator.clipboard.writeText(notes.value||'');toast('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')}},'ã‚³ãƒ”ãƒ¼');
        const saveBtn=el('button',{class:'btn',onclick:()=>{notes.setAttribute('data-saved','1');toast('ä¸€æ™‚ä¿å­˜ã—ã¾ã—ãŸ')}},'ä¸€æ™‚ä¿å­˜');
        const card=el('div',{class:'guide'},el('h4',{},'ğŸ’¡ ',g.title),tipsList,el('label',{},'ã‚ãªãŸã®ä¿®æ­£æ¡ˆã‚’å…¥åŠ›'),notes,el('div',{class:'mini-actions'},saveBtn,copyBtn));
        guidesRoot.appendChild(card);
      });
    }
    exportTxtBtn?.addEventListener('click',()=>{
      const notes=$$('#guides-root .notes').map(n=>{const id=n.getAttribute('data-issue-id');const title=GUIDES[id]?.title||id;const v=n.value.trim();return `ã€${title}ã€‘\n${v or 'ï¼ˆæœªå…¥åŠ›ï¼‰'}`}).join('\n\n');
    });
  </script>
  <script>
    copyAllBtn?.addEventListener('click', async ()=>{
      const text=Array.from($$('#guides-root .guide')).map(card=>{
        const title=card.querySelector('h4')?.innerText??'';
        const tips=Array.from(card.querySelectorAll('.tips li')).map(li=>'ãƒ»'+li.innerText).join('\n');
        const val=card.querySelector('.notes')?.value??'';
        return `${title}\n${tips}\n\nã‚ãªãŸã®ä¿®æ­£æ¡ˆ:\n${val}\n`;
      }).join('\n----------------------\n\n');
      await navigator.clipboard.writeText(text); toast('å…¨ä½“ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
    });
    let toastTimer=null;
    function toast(msg){
      let t=document.querySelector('#toast');
      if(!t){ t=document.createElement('div'); t.id='toast'; t.setAttribute('style','position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#10151E;border:1px solid #2A3240;color:#E9EEF5;padding:10px 14px;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.35);z-index:9999'); document.body.appendChild(t); }
      t.textContent=msg; t.style.opacity='1'; clearTimeout(toastTimer); toastTimer=setTimeout(()=>{t.style.opacity='0'},1600);
    }
    document.querySelector('#view-guides-btn')?.addEventListener('click', openGuides);
    document.querySelector('#view-guides-btn-mobile')?.addEventListener('click', openGuides);
    document.querySelector('#reupload-btn')?.addEventListener('click', ()=>{document.querySelector('#result-wrap').hidden=true;document.querySelector('#guides-section').hidden=true;document.querySelector('#upload-section').hidden=false;document.querySelector('#guides-root').innerHTML=''});
    document.addEventListener('keydown', e=>{if(e.key==='/'){e.preventDefault();document.querySelector('#result-wrap').hidden?null:openGuides()}});
  </script>
</body>
</html>
